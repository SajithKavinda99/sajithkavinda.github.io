<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive Timetable Editor</title>
    <style>
        /* General Styles */
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        /* Toolbar Styles */
        .toolbar {
            background-color: #4CAF50;
            color: white;
            padding: 15px 20px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        button {
            background-color: #333;
            border: none;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 5px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #45a049;
        }

        /* Table Styles */
        .timetable {
            border-collapse: collapse;
            width: calc(100% - 300px); /* Takes up remaining space minus the side panel width */
            margin-top: 20px;
            min-width: 320px;
            flex-grow: 1;
            overflow: auto;
        }

        .timetable th, .timetable td {
            border: 1px solid #333;
            padding: 20px;
            text-align: center;
            position: relative;
            cursor: pointer;
            background-color: #fff;
        }

        /* Resize handle */
        .resize-handle {
            position: absolute;
            right: 0;
            bottom: 0;
            cursor: nwse-resize;
            width: 10px;
            height: 10px;
            background-color: #000;
        }

        /* Side Panel Styles */
        .side-panel {
            width: 250px;
            background-color: #ffffff;
            padding: 20px;
            position: fixed;
            right: 0;
            top: 85px; /* Adjusted to start below the toolbar */
            bottom: 0;
            box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
            display: none;
            overflow-y: auto;
            transition: all 0.3s;
            border-style: groove;
            border-color: #013806;
            
        }

        .side-panel.active {
            display: block;
        }

        .side-panel h3 {
            margin-bottom: 20px;
            font-size: 18px;
        }

        .side-panel input[type="text"],
        .side-panel input[type="color"],
        .side-panel select,
        .side-panel button {
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 16px;
        }

        .style-btn {
            background-color: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }

        .style-btn:hover {
            background-color: #45a049;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .side-panel {
                width: 100%;
                height: 100%;
                bottom: 0;
                top: 50px; /* Adjusted to take the toolbar height into account */
                box-shadow: none;
                border-radius: 0;
            }

            .timetable {
                width: 100%; /* Full width on small screens */
                margin-right: 0;
            }
        }
    </style>
    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>

    <div class="toolbar">
        <button id="addRowBtn">Add Row</button>
        <button id="addColumnBtn">Add Column</button>
        <button id="removeRowBtn">Remove Row</button>
        <button id="removeColumnBtn">Remove Column</button>
        <button id="downloadBtn">Download PDF</button> <!-- Download Button -->
        <button><a style="text-decoration: none; color: white;" href="gallery.html">Leave from Page</a></button> <!-- Download Button -->

    </div>

    <table class="timetable" id="timetable">
        <!-- Table rows and columns will be added here dynamically -->
    </table>

    <!-- Side Panel for Text and Color Editing -->
    <div class="side-panel" id="sidePanel">
        <h3>Edit Cell</h3>
        <input type="text" id="cellText" placeholder="Enter text" />
        <label for="cellColor">Cell Color:</label>
        <input type="color" id="cellColor" />
        <div>
            <button class="style-btn" id="boldBtn">Bold</button>
            <button class="style-btn" id="italicBtn">Italic</button>
        </div>
        <label for="fontSize">Font Size:</label>
        <select id="fontSize">
            <option value="12px">12px</option>
            <option value="16px">16px</option>
            <option value="20px">20px</option>
            <option value="24px">24px</option>
        </select>

        <!-- New font color and alignment options -->
        <label for="fontColor">Font Color:</label>
        <input type="color" id="fontColor" />

        <label for="textAlign">Text Alignment:</label>
        <select id="textAlign">
            <option value="left">Left</option>
            <option value="center">Center</option>
            <option value="right">Right</option>
        </select>

        <!-- Reset Button -->
        <div>
            <button class="style-btn" id="resetBtn">Reset Format</button>
        </div>
    </div>

    <script>
        class TimetableEditor {
            constructor(tableId) {
                this.table = document.getElementById(tableId);
                this.rows = 5;
                this.cols = 5;
                this.cellData = Array.from({ length: this.rows }, () => Array(this.cols).fill(''));
                this.selectedCell = { row: null, col: null };
                this.initTable();
            }

            initTable() {
                this.table.innerHTML = ''; // Clear the table first
                for (let row = 0; row < this.rows; row++) {
                    let tableRow = this.table.insertRow();
                    for (let col = 0; col < this.cols; col++) {
                        let cell = tableRow.insertCell();
                        cell.contentEditable = true;
                        cell.innerText = this.cellData[row][col];
                        cell.addEventListener('click', this.onCellClick.bind(this, row, col));
                        this.addResizeHandle(cell, row, col);
                    }
                }
            }

            addResizeHandle(cell, row, col) {
                const resizeHandle = document.createElement('div');
                resizeHandle.className = 'resize-handle';
                cell.appendChild(resizeHandle);

                let resizing = false;

                resizeHandle.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    resizing = true;
                    document.body.style.cursor = 'nwse-resize';
                    const startX = e.clientX;
                    const startY = e.clientY;
                    const startWidth = cell.offsetWidth;
                    const startHeight = cell.offsetHeight;

                    const onMouseMove = (e) => {
                        if (resizing) {
                            const newWidth = startWidth + (e.clientX - startX);
                            const newHeight = startHeight + (e.clientY - startY);
                            cell.style.width = `${newWidth}px`;
                            cell.style.height = `${newHeight}px`;
                        }
                    };

                    const onMouseUp = () => {
                        resizing = false;
                        document.body.style.cursor = 'auto';
                        document.removeEventListener('mousemove', onMouseMove);
                        document.removeEventListener('mouseup', onMouseUp);
                    };

                    document.addEventListener('mousemove', onMouseMove);
                    document.addEventListener('mouseup', onMouseUp);
                });
            }

            onCellClick(row, col) {
                this.selectedCell = { row, col };
                const currentText = this.cellData[row][col];
                const currentColor = document.getElementById("timetable").rows[row].cells[col].style.backgroundColor || "#ffffff";
                const currentFontSize = document.getElementById("timetable").rows[row].cells[col].style.fontSize || "16px";
                const currentFontColor = document.getElementById("timetable").rows[row].cells[col].style.color || "#000000";
                const currentTextAlign = document.getElementById("timetable").rows[row].cells[col].style.textAlign || "center";

                document.getElementById('cellText').value = currentText;
                document.getElementById('cellColor').value = currentColor;
                document.getElementById('fontSize').value = currentFontSize;
                document.getElementById('fontColor').value = currentFontColor;
                document.getElementById('textAlign').value = currentTextAlign;

                document.getElementById('sidePanel').classList.add('active');
                
                // Attach event listeners for live updates
                this.attachLiveUpdates();
            }

            attachLiveUpdates() {
                // Update text
                document.getElementById('cellText').addEventListener('input', () => this.updateCell());
                // Update background color
                document.getElementById('cellColor').addEventListener('input', () => this.updateCell());
                // Update font size
                document.getElementById('fontSize').addEventListener('change', () => this.updateCell());
                // Update font color
                document.getElementById('fontColor').addEventListener('input', () => this.updateCell());
                // Update text alignment
                document.getElementById('textAlign').addEventListener('change', () => this.updateCell());

                // Bold Button
                document.getElementById('boldBtn').addEventListener('click', () => this.toggleBold());
                // Italic Button
                document.getElementById('italicBtn').addEventListener('click', () => this.toggleItalic());
            }

            updateCell() {
                const { row, col } = this.selectedCell;
                const newText = document.getElementById('cellText').value;
                const newColor = document.getElementById('cellColor').value;
                const newFontSize = document.getElementById('fontSize').value;
                const newFontColor = document.getElementById('fontColor').value;
                const newTextAlign = document.getElementById('textAlign').value;

                this.cellData[row][col] = newText;

                const cell = document.getElementById("timetable").rows[row].cells[col];
                cell.style.backgroundColor = newColor;
                cell.style.fontSize = newFontSize;
                cell.style.color = newFontColor;
                cell.style.textAlign = newTextAlign;
                cell.innerText = newText;
            }

            toggleBold() {
                const { row, col } = this.selectedCell;
                const cell = document.getElementById("timetable").rows[row].cells[col];
                const currentFontWeight = cell.style.fontWeight;

                // Toggle bold
                if (currentFontWeight === 'bold') {
                    cell.style.fontWeight = 'normal';
                } else {
                    cell.style.fontWeight = 'bold';
                }
            }

            toggleItalic() {
                const { row, col } = this.selectedCell;
                const cell = document.getElementById("timetable").rows[row].cells[col];
                const currentFontStyle = cell.style.fontStyle;

                // Toggle italic
                if (currentFontStyle === 'italic') {
                    cell.style.fontStyle = 'normal';
                } else {
                    cell.style.fontStyle = 'italic';
                }
            }

            // Reset the selected cell to its default state
            resetCell() {
                const { row, col } = this.selectedCell;

                // Reset content and style
                const cell = document.getElementById("timetable").rows[row].cells[col];
                cell.innerText = '';  // Reset the text to empty
                cell.style.backgroundColor = '#ffffff';  // Reset background to white
                cell.style.fontSize = '16px';  // Reset font size
                cell.style.color = '#000000';  // Reset font color to black
                cell.style.textAlign = 'center';  // Reset text alignment to center

                // Reset the side panel inputs to match the reset cell values
                document.getElementById('cellText').value = '';
                document.getElementById('cellColor').value = '#ffffff';  // Default color white
                document.getElementById('fontSize').value = '16px';
                document.getElementById('fontColor').value = '#000000';  // Default color black
                document.getElementById('textAlign').value = 'center';
            }

            addRow() {
                this.rows++;
                this.cellData.push(Array(this.cols).fill(''));
                this.initTable();
            }

            addColumn() {
                this.cols++;
                this.cellData.forEach(row => row.push(''));
                this.initTable();
            }

            removeRow() {
                if (this.rows > 1) {
                    this.rows--;
                    this.cellData.pop();
                    this.initTable();
                }
            }

            removeColumn() {
                if (this.cols > 1) {
                    this.cols--;
                    this.cellData.forEach(row => row.pop());
                    this.initTable();
                }
            }

            // Download Table as PDF
            downloadTable() {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const table = this.table;
                const rows = table.rows;

                // Loop through the table rows and cells to add content to PDF
                let startX = 10;
                let startY = 10;
                const cellWidth = 30;
                const cellHeight = 20;

                for (let i = 0; i < rows.length; i++) {
                    let row = rows[i];
                    for (let j = 0; j < row.cells.length; j++) {
                        const cell = row.cells[j];
                        doc.rect(startX + j * cellWidth, startY + i * cellHeight, cellWidth, cellHeight);  // Draw cell borders
                        doc.text(cell.innerText, startX + j * cellWidth + 5, startY + i * cellHeight + 15);  // Add text to the cell
                    }
                }

                doc.save('timetable.pdf');  // Download the PDF
            }
        }

        const timetableEditor = new TimetableEditor('timetable');

        // Toolbar button actions
        document.getElementById('addRowBtn').addEventListener('click', () => timetableEditor.addRow());
        document.getElementById('addColumnBtn').addEventListener('click', () => timetableEditor.addColumn());
        document.getElementById('removeRowBtn').addEventListener('click', () => timetableEditor.removeRow());
        document.getElementById('removeColumnBtn').addEventListener('click', () => timetableEditor.removeColumn());
        document.getElementById('resetBtn').addEventListener('click', () => timetableEditor.resetCell());
        document.getElementById('downloadBtn').addEventListener('click', () => timetableEditor.downloadTable());  // Download button action
    </script>

</body>
</html>
